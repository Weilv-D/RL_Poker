:root {
    /* Exquisite Zen Palette */
    --bg-paper: #f7f5f0; /* Slightly brighter, cleaner rice paper */
    
    --ink-primary: #2b2b2b;  /* Soft charcoal, not pitch black */
    --ink-secondary: #666666; 
    
    --accent-red: #b83b3b; /* Cinnabar Red (Seal color) */
    --accent-red-dim: #8a2a2a;
    --accent-gold: #cfa86e; /* Muted Gold */
    --accent-border: #dcdad5;

    --card-bg: #fdfcf8;
    --card-border: #e6e4de;
    --card-shadow: 0 8px 24px rgba(40, 40, 40, 0.08); /* Softer, deeper shadow */
    
    --font-serif: "Noto Serif SC", "Songti SC", "Source Han Serif SC", serif;
    --font-sans: "Noto Sans SC", "Microsoft YaHei", sans-serif;
    --font-art: "Ma Shan Zheng", cursive;
}

* {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

body {
    margin: 0;
    padding: 0;
    background-color: var(--bg-paper);
    /* High quality subtle paper noise */
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E");
    font-family: var(--font-serif);
    color: var(--ink-primary);
    overflow: hidden;
    height: 100vh;
    display: flex;
    flex-direction: column;
    touch-action: manipulation;
    user-select: none;
}

.hidden { display: none !important; }

/* --- Ink Overlay (Modal) --- */
#overlay {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(240, 239, 233, 0.95);
    z-index: 1000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: opacity 0.5s ease;
}

.modal {
    width: 90%;
    max-width: 380px; 
    text-align: center;
    padding: 60px 40px; /* More vertical breath */
    border: none;
    border-radius: 2px;
    position: relative;
    background: #fffdf9; /* Slightly warm */
    box-shadow: 0 30px 60px rgba(0,0,0,0.1); 
    /* Refined double border */
    outline: 1px solid rgba(0,0,0,0.03);
    outline-offset: -12px;
}

/* Red Seal Decoration - Refined */
.modal::after {
    content: 'ç¦…';
    font-family: var(--font-art);
    font-size: 1.8rem;
    color: rgba(255,255,255,0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    
    position: absolute;
    top: 50px;
    right: 40px;
    width: 50px;
    height: 50px;
    background: var(--accent-red);
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(184, 59, 59, 0.3);
    transform: rotate(8deg); /* Slightly less rotation */
    z-index: 10;
    
    /* Simulate ink imperfection */
    mask-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' fill='white'/%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.2'/%3E%3C/svg%3E");
}

.modal h1 {
    font-family: var(--font-art); /* Artistic Font */
    font-size: 3.5rem;
    font-weight: normal;
    letter-spacing: 0.8rem;
    margin: 0 0 50px 0;
    color: var(--ink-primary);
    /* Remove underline, use spacing */
    border-bottom: none;
    display: block;
    padding-bottom: 0;
    text-shadow: 0 2px 0 rgba(0,0,0,0.05);
}

.form-group {
    margin-bottom: 30px;
    text-align: left;
    position: relative;
}

.form-group label {
    display: block;
    color: var(--ink-secondary);
    font-size: 0.85rem;
    margin-bottom: 10px;
    font-family: var(--font-serif);
    font-weight: normal;
    letter-spacing: 2px;
}

.form-control {
    width: 100%;
    padding: 12px 0;
    background: transparent;
    border: none;
    border-bottom: 2px solid #eee;
    font-family: var(--font-serif);
    font-size: 1rem;
    color: var(--ink-primary);
    border-radius: 0; 
    outline: none;
    -webkit-appearance: none; 
    cursor: pointer;
    transition: border-color 0.3s;
}

/* Custom Select Arrow */
select.form-control {
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right center;
    background-size: 16px;
}

.form-control:focus {
    border-color: var(--accent-red);
    background: transparent;
}

.btn-start {
    width: 100%;
    margin-top: 30px;
    padding: 18px;
    background: var(--ink-primary);
    color: #fff;
    font-family: var(--font-serif);
    font-size: 1.1rem;
    font-weight: normal;
    letter-spacing: 6px; /* Wider spacing */
    border: none;
    cursor: pointer;
    transition: all 0.4s ease;
    border-radius: 2px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.btn-start:hover {
    background: var(--accent-red); 
    box-shadow: 0 8px 25px rgba(184, 59, 59, 0.25);
    letter-spacing: 12px; /* Expanding text effect */
}

.btn-start:active {
    background: var(--accent-red-dim);
    transform: translateY(0);
}

/* --- Main Layout --- */
#main-ui {
    flex: 1;
    display: flex;
    flex-direction: column;
    position: relative;
    max-width: 1200px;
    margin: 0 auto; /* Center on large screens */
    width: 100%;
}

/* Header - Minimalist Top Bar */
header {
    height: 70px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 40px;
    border-bottom: 1px solid rgba(0,0,0,0.03); /* Fainter line */
}

.logo {
    font-size: 1.6rem;
    font-weight: normal;
    font-family: var(--font-art);
    color: var(--ink-primary);
    letter-spacing: 4px;
    display: flex;
    align-items: center;
}
.logo span { 
    color: #fff;
    background: var(--accent-red);
    padding: 2px 6px;
    border-radius: 4px;
    margin-right: 8px;
    font-size: 1.2rem;
    box-shadow: 0 2px 5px rgba(184, 59, 59, 0.3);
}

.game-status-bar {
    font-family: var(--font-serif);
    font-size: 0.95rem;
    color: var(--ink-secondary);
    letter-spacing: 1px;
}

#btn-config {
    background: transparent;
    border: 1px solid rgba(0,0,0,0.1);
    color: var(--ink-secondary);
    padding: 6px 16px;
    font-size: 0.85rem;
    font-family: var(--font-serif);
    cursor: pointer;
    border-radius: 20px;
    transition: all 0.2s;
}
#btn-config:hover {
    border-color: var(--ink-primary);
    color: var(--ink-primary);
}

/* Arena Layout - Balanced Geometry */
#arena {
    flex: 1;
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

/* Opponent Positions - Circular Arrangement */
.opponents-container {
    position: absolute;
    top: 20px;
    left: 0;
    right: 0;
    bottom: 40%; /* Top half of screen */
    pointer-events: none; /* Let clicks pass through empty space */
}

.opponent {
    position: absolute;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: opacity 0.3s;
    width: 80px;
}

/* Clean Geometry Avatars -> Seal Style */
.avatar-box {
    width: 60px;
    height: 60px;
    /* Red Seal Background style */
    background-color: #fff; 
    border: 3px double var(--accent-red);
    color: var(--accent-red);
    
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-family: var(--font-art); /* Artistic font for name */
    font-size: 1.1rem;
    
    margin-bottom: 12px;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    border-radius: 8px; /* Slight roundness */
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}

.opponent.active .avatar-box {
    background-color: var(--accent-red);
    color: #fff;
    border-color: var(--accent-red);
    box-shadow: 0 8px 20px rgba(184, 59, 59, 0.3);
    transform: scale(1.15) rotate(-2deg); /* Dynamic active state */
}

.opp-info {
    font-family: var(--font-serif);
    font-size: 0.9rem; /* Larger */
    color: var(--ink-secondary);
    background: transparent;
    padding: 0;
    margin-top: 8px;
    border-radius: 0;
    opacity: 0.9; /* More visible */
    font-weight: bold;
}
/* Mobile-friendly positioning */
#opp-top { top: 0; left: 50%; transform: translateX(-50%); }
#opp-left { top: 40%; left: 40px; transform: translateY(-50%); } /* Shifted down slightly less than 50% maybe? No, 50 is center. Moved inward (40px) */
#opp-right { top: 40%; right: 40px; transform: translateY(-50%); } /* Improve margins */

/* Table Center - The "Paper" Area */
#table-center {
    width: 100%;
    height: 180px; 
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 60px; /* Push down further to clear top player */
    z-index: 10;
}

#table-message {
    position: absolute;
    font-size: 3rem; /* Larger */
    font-family: var(--font-art);
    color: var(--ink-primary);
    opacity: 0.15; /* Watermark style */
    pointer-events: none;
    letter-spacing: 1rem;
    z-index: 0;
}

#played-container {
    display: flex;
    justify-content: center;
    gap: 0; 
    z-index: 1;
}

#played-container .card {
    transform: scale(0.8); /* Slightly smaller played cards */
    margin: 0 -15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}


/* --- User Zone (Bottom) --- */
#user-zone {
    height: 50vh; /* More space */
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    align-items: center;
    position: relative;
    padding-bottom: 3vh;
    background: linear-gradient(to top, rgba(230,228,220,0.9), transparent 25%); /* Fade in from bottom */
}

#my-info {
    position: relative; /* Not absolute */
    top: auto; left: auto;
    margin-bottom: 20px;
    
    font-family: var(--font-serif);
    font-size: 1rem;
    color: var(--ink-secondary);
    background: #fff;
    padding: 8px 30px; /* Wider */
    border-radius: 4px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    border: 1px solid rgba(0,0,0,0.05);
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 200px;
}

#my-info strong {
    color: var(--accent-red);
    font-size: 1.15rem;
    font-weight: normal;
    font-family: 'Times New Roman', serif;
}

#my-info .my-name {
    font-weight: bold;
    color: var(--ink-primary);
    font-family: var(--font-serif);
    font-size: 1rem;
}

#my-info .divider {
    margin: 0 5px;
    opacity: 0.4;
}

/* Controls - Floating above hand */
#controls {
    margin-bottom: 20px;
    display: flex;
    gap: 30px;
    z-index: 200;
}

#prestart-controls {
    margin-bottom: 12px;
    display: flex;
    gap: 18px;
    z-index: 200;
}

#prestart-controls .action-btn {
    min-width: 120px;
    font-size: 1rem;
    letter-spacing: 2px;
}

.action-btn {
    min-width: 140px;
    padding: 14px 0;
    border-radius: 4px; /* More rectangular, traditional */
    border: 1px solid var(--ink-secondary); /* Darker border */
    background: #fff;
    font-family: var(--font-serif);
    font-weight: bold; /* Bolder */
    font-size: 1.1rem;
    letter-spacing: 3px;
    color: var(--ink-primary);
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08); /* Soft shadow */
    transition: all 0.3s ease;
    
    touch-action: manipulation;
}

.action-btn:active:not(:disabled) {
    transform: translateY(2px);
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

#btn-play {
    background: var(--ink-primary);
    color: #fff;
    border-color: var(--ink-primary);
}
#btn-play:hover:not(:disabled) {
    background: var(--accent-red); /* Ink to Seal Red interaction */
    border-color: var(--accent-red);
    box-shadow: 0 6px 15px rgba(184, 59, 59, 0.25);
}
#btn-play:disabled {
    background: #f0f0f0; /* Lighter disabled bg */
    border-color: #ddd;
    color: #bbb;
    box-shadow: none;
    cursor: not-allowed;
}

#btn-pass {
    background: transparent;
    color: var(--ink-secondary);
    border-color: transparent;
    box-shadow: none;
}
#btn-pass:hover:not(:disabled) {
    background: rgba(0,0,0,0.03);
    color: var(--ink-primary);
}
#btn-pass:disabled {
    color: #ccc;
    cursor: not-allowed;
}

#btn-begin {
    background: var(--accent-red);
    color: #fff;
    border-color: var(--accent-red);
}
#btn-begin:hover:not(:disabled) {
    background: var(--accent-red-dim);
    border-color: var(--accent-red-dim);
}
#btn-begin:disabled {
    background: #f0f0f0;
    border-color: #ddd;
    color: #bbb;
    box-shadow: none;
    cursor: not-allowed;
}

#btn-shuffle {
    background: transparent;
    color: var(--ink-secondary);
    border-color: var(--ink-secondary);
}
#btn-shuffle:hover:not(:disabled) {
    background: rgba(0,0,0,0.03);
    color: var(--ink-primary);
}
#btn-shuffle:disabled {
    color: #ccc;
    border-color: #ddd;
    cursor: not-allowed;
}

/* Hand Container */
#hand-container {
    display: flex;
    justify-content: center;
    align-items: flex-end;
    height: 180px;
    width: 100%;
    overflow-x: auto; /* Allow Scroll on extremely small screens if truncated? prefer wrap or squeeze */
    overflow-y: visible;
    padding: 0 20px 10px 20px;
    perspective: 1000px;
}

/* Card Design - Minimalist & Textured */
.card {
    width: 96px;  
    height: 136px;
    background-color: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 6px;
    
    /* Subtle paper texture on card */
    background-image: linear-gradient(#fff, #fbfbf8);
    box-shadow: var(--card-shadow), inset 0 0 0 1px #fff; /* Inner highlight */
    
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: 8px 6px;
    
    font-family: "Playfair Display", "Times New Roman", serif; 
    font-weight: 700;
    
    position: relative;
    /* Removed margin-bottom from transition to prevent layout thrashing */
    transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s ease;
    user-select: none;
    cursor: pointer;
    
    /* Fan Spacing - Relaxed from -30px to -14px to reduce overlap friction */
    margin: 0 -14px; 
    transform-origin: bottom center;
}

/* Fix flickering: Extend interactive area downwards when card lifts */
.card::after {
    content: '';
    position: absolute;
    left: 0; right: 0; bottom: 0;
    height: 0;
    /* z-index: -1; Removed to ensure hitbox is always top-level and catches mouse */
}
.card:hover::after {
    height: 40px; /* Sufficient to cover the translateY lift + overshot */
    bottom: -40px;
}

/* Center symbol watermark */
.card::before {
    content: attr(data-suit);
    position: absolute;
    top: 55%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 4rem;
    opacity: 0.04; 
    color: currentColor;
    pointer-events: none;
    filter: blur(1px); 
}

.card:hover {
    z-index: 100;
    transform: translateY(-20px); /* Pure visual lift */
    box-shadow: 0 12px 28px rgba(0,0,0,0.12);
}

.card.selected {
    transform: translateY(-40px);
    z-index: 50;
    border: 1px solid var(--accent-red);
    box-shadow: 0 12px 30px rgba(184, 59, 59, 0.15);
}

.card.selected:hover {
    transform: translateY(-45px); /* Add slight lift feedback on selected items too */
    z-index: 100;
}

/* Typography on Card */
.card-top {
    font-size: 1.4rem;
    line-height: 1;
    text-align: left;
    padding-left: 2px;
}
.card-suit-sm {
    font-size: 1rem;
    display: block;
    margin-top: 4px;
    opacity: 0.9;
}

/* Colors */
.suit-red { color: var(--accent-red); }
.suit-black { color: var(--ink-primary); }

/* Bottom right rank (rotated) */
.card-bottom {
    transform: rotate(180deg);
    text-align: left;
    font-size: 1.3rem;
    line-height: 1;
    padding-left: 4px;
}

/* --- Log Panel --- */
#log-panel {
    position: fixed;
    bottom: 20px;
    left: 20px;
    width: 280px;
    max-height: 200px;
    
    font-family: var(--font-serif);
    font-size: 0.85rem;
    line-height: 1.6;
    color: var(--ink-secondary);
    
    background: rgba(255, 255, 255, 0.9);
    padding: 15px 20px;
    border-radius: 4px;
    border-left: 3px solid var(--accent-red); /* Zen accent */
    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    
    overflow-y: auto;
    /* Custom Scrollbar */
    scrollbar-width: thin;
    scrollbar-color: #ddd transparent;
    
    pointer-events: auto; /* Allow scrolling */
    display: none; 
    transition: opacity 0.3s;
    z-index: 50;
}

#log-panel::-webkit-scrollbar { width: 4px; }
#log-panel::-webkit-scrollbar-thumb { background: #ddd; }

.log-line {
    margin-bottom: 6px;
    border-bottom: 1px dashed rgba(0,0,0,0.05);
    padding-bottom: 4px;
}
.log-line:last-child {
    border-bottom: none;
    margin-bottom: 0;
    font-weight: bold;
    color: var(--ink-primary);
}

@media (min-width: 768px) {
    #log-panel { display: block; }
    .card {
        width: 100px;
        height: 145px;
        margin: 0 -30px;
    }
    .card:hover {
         transform: translateY(-40px);
    }
}
